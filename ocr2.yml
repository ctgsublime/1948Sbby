name: "OCR Detection - Offensive Content in Images"
description: "Scans images in emails using OCR to detect offensive, threatening, or inappropriate text content"
type: rule
severity: medium
authors:
  - "Security Team"
references:
  - "https://docs.sublimesecurity.com"

source: |
  type.inbound
  and any(attachments,
    (
      .file_type in~ ("jpg", "jpeg", "png", "gif", "bmp", "tiff", "webp")
      or .file_extension in~ ("jpg", "jpeg", "png", "gif", "bmp", "tiff", "webp")
    )
    and any(ml.ocr(.).strings,
      regex.icontains(.,
        // Threats and violence
        '(kill|murder|shoot|bomb|attack|destroy|hurt|harm)\s+(you|your|them|everyone)',
        
        // Explicit threats
        'i(\s|\')?ll\s+(kill|hurt|get|find)\s+you',
        'you(\s|\')?re\s+dead',
        'watch\s+your\s+back',
        
        // Harassment and slurs (add specific terms as needed)
        '\b(threat|die|死|殺)\b',
        
        // Extortion language
        '(pay|send)\s+(money|bitcoin|crypto|btc)',
        'or\s+else',
        'consequences',
        
        // Explicit content indicators
        'explicit',
        'nsfw',
        '18\+',
        'xxx'
      )
    )
  )

tags:
  - "Attack Type: Harassment"
  - "Attack Type: Threat"
  - "Attack Type: Offensive Content"
  - "Detection: OCR"

attack_types:
  - "Harassment"
  - "Threat"
  
tactics_and_techniques:
  - "T1566: Phishing"
  - "T1204: User Execution"
